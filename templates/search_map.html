{% load i18n %}

{% include "pagination.html" %}

<div id="map" class="smallmap"></div>
<script type="text/javascript" src="http://www.openlayers.org/api/OpenLayers.js"></script>
<!-- <script type="text/javascript" src="{{ MEDIA_URL }}js/OpenLayers.js"></script> -->
<script defer="defer" type="text/javascript">
    function marker( lon, lat, image ) {
        return new OpenLayers.Marker(
            new OpenLayers.LonLat( lon, lat ).transform(
                new OpenLayers.Projection( "EPSG:4326" ),
                map.getProjectionObject()
            ),
            new OpenLayers.Icon( image, new OpenLayers.Size( 40, 40 ), new OpenLayers.Pixel( -10, -35 ) )
        );
    }
    map = new OpenLayers.Map( "map", {
            controls:[
                new OpenLayers.Control.Navigation(),
                new OpenLayers.Control.PanZoomBar(),
                new OpenLayers.Control.LayerSwitcher(),
                new OpenLayers.Control.Attribution()],
            projection: new OpenLayers.Projection( "EPSG:900913" ),
            displayProjection: new OpenLayers.Projection( "EPSG:4326" )
    } );
    map.addLayer( new OpenLayers.Layer.OSM() );
    var pois = new OpenLayers.Layer.Markers( "{% trans "Marker" %}" );
    //These lines should be a list automatically generated by Django
    {% for event in events.object_list %}
        {% if event.latitude and event.longitude %}
            color_nr = {{ event.color_nr }}
            pois.addMarker( this.marker( {{ event.longitude }}, {{ event.latitude }},
                        "{{ MEDIA_URL }}markers/color_{{ event.color_nr }}_nr_{{ forloop.counter0 }}.png" ) );
        {% endif %}
    {% endfor %}
    map.addLayer( pois );
    mapArea = pois.getDataExtent().toArray();
    // map.zoomToMaxExtent();
    map.setCenter (
        new OpenLayers.LonLat( ( mapArea[0] + mapArea[2]) /2, ( mapArea[1] + mapArea[3] ) /2 ),
        map.getZoomForExtent( pois.getDataExtent(), true ) -1
    );
</script>
</div>

<div>
    <ul>
        {% for event in events.object_list %}
            <li>
                {% if event.latitude and event.longitude %}
                    <img src="{{ MEDIA_URL }}markers/color_{{ event.color_nr }}_nr_{{ forloop.counter0 }}.png"
                        alt="color_{{ event.color_nr }}_nr_{{ forloop.counter0 }}" />
                {% endif %}
                {% include "event_show_small.html" %}
            </li>
        {% endfor %}
    </ul>
</div>
